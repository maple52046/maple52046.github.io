<!DOCTYPE html>
<html><head lang="en">
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Install Rally 筆記 (OpenStack benchmark) - 世界的盡頭</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Rally 是一套 OpenStack benchmark tool。關於 Rally 的介紹本文就不再贅述。本篇安裝時是以 OpenStack 官方 Wiki 的教學為參考內容，紀錄安裝與使用 Rally 的筆記。" />
	<meta property="og:image" content=""/>
	<meta property="og:title" content="Install Rally 筆記 (OpenStack benchmark)" />
<meta property="og:description" content="Rally 是一套 OpenStack benchmark tool。關於 Rally 的介紹本文就不再贅述。本篇安裝時是以 OpenStack 官方 Wiki 的教學為參考內容，紀錄安裝與使用 Rally 的筆記。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://maple52046.github.io/posts/rally-installation/" /><meta property="og:image" content="https://maple52046.github.io/site-thumbnail.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2015-02-24T16:45:00+00:00" />
<meta property="article:modified_time" content="2015-02-24T16:45:00+00:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://maple52046.github.io/site-thumbnail.png" /><meta name="twitter:title" content="Install Rally 筆記 (OpenStack benchmark)"/>
<meta name="twitter:description" content="Rally 是一套 OpenStack benchmark tool。關於 Rally 的介紹本文就不再贅述。本篇安裝時是以 OpenStack 官方 Wiki 的教學為參考內容，紀錄安裝與使用 Rally 的筆記。"/>

	
        <link href="https://maple52046.github.io/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css" rel="stylesheet">
	

	
	<link rel="stylesheet" type="text/css" media="screen" href="https://maple52046.github.io/css/main.ac08a4c9714baa859217f92f051deb58df2938ec352b506df655005dcaf98cc0.css" />

	
	

	
	
	
	
</head>
<body>
        <div class="content"><header>
	<div class="main">
		<a href="https://maple52046.github.io">世界的盡頭</a>
	</div>
	<nav>
		
		
	</nav>
</header>

<main>
	<article>
		<div class="title">
			<h1 class="title">Install Rally 筆記 (OpenStack benchmark)</h1>
			<div class="meta">Posted on Feb 24, 2015</div>
		</div>
		

		<section class="body">
			<p><a href="http://rally.readthedocs.org/en/latest/index.html">Rally</a> 是一套 OpenStack benchmark tool。關於 Rally 的介紹本文就不再贅述。本篇安裝時是以 <a href="https://wiki.openstack.org/wiki/Rally#How_To">OpenStack 官方 Wiki</a> 的教學為參考內容，紀錄安裝與使用 Rally 的筆記。</p>
<h2 id="實驗環境">實驗環境</h2>
<table>
<thead>
<tr>
<th>Item</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Operating System</td>
<td>Ubuntu 12.04 x64</td>
</tr>
<tr>
<td>Python version</td>
<td>Python 2.7</td>
</tr>
<tr>
<td>OpenStack version</td>
<td>Grizzly (2013)</td>
</tr>
</tbody>
</table>
<h2 id="install-rally">Install Rally</h2>
<p>一開始是想要安裝在 OpenStack controller node 上，但是一直裝不起來，看起來似乎是 python module 的版本問題，不過我沒有仔細研究到底是哪個 module 的哪個版本卡住。</p>
<p>直接在 OpenStack 上開了一個新的 VM，一樣是選擇 Ubuntu 12.04，就可以直接安裝。<em>(不過現在回想起來，應該要用 virtualenv 來裝就可以解決，也不會影響原本的系統。)</em></p>
<blockquote>
<p>PS: Rally 可以跟 DevStack 一起部署。參考: <a href="https://wiki.openstack.org/wiki/Rally/installation#Rally_with_DevStack_all_in_one_installation">Rally with DevStack all in one installation</a></p>
</blockquote>
<p><strong>Step</strong>:</p>
<ol>
<li>下載 source code</li>
</ol>
<pre tabindex="0"><code>root@rally:~# git clone https://git.openstack.org/stackforge/rally
</code></pre><ol start="2">
<li>執行 script</li>
</ol>
<pre tabindex="0"><code>root@rally:~# ./rally/install_rally.sh
</code></pre><ol start="3">
<li>安裝並執行 tox (當前版本可以跳過此步驟)</li>
</ol>
<pre tabindex="0"><code>root@rally:~# pip install &#39;tox==1.6.1&#39;
root@rally:~# tox
</code></pre><h2 id="deployment-initialization">Deployment initialization</h2>
<p>安裝完 Rally 之後，再進行下一步之前，必須要確定該 host 可以使用 OpenStack API</p>
<p>建立 OpenStack credentials (openrc)，然後看看 keystone client 是否可已使用:</p>
<p>建立 RC file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>export OS_TENANT_NAME<span style="color:#f92672">=</span>admin
</span></span><span style="display:flex;"><span>export OS_USERNAE<span style="color:#f92672">=</span>admin
</span></span><span style="display:flex;"><span>export OS_PASSWORD<span style="color:#f92672">=</span>myStackAdmin
</span></span><span style="display:flex;"><span>export OS_AUTH_URL<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://myopenstack:5000/v2.0/&#34;</span>
</span></span><span style="display:flex;"><span>export OS_SERVICE_ENDPOINT<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://myopenstack:35357/v2.0&#34;</span>
</span></span><span style="display:flex;"><span>export OS_SERVICE_TOKEN<span style="color:#f92672">=</span>myOpenStackAdminToken28143
</span></span></code></pre></div><p>測試 keystone 指令是否能使用:  <em>(keystone client 已經在 install_rally.sh 的時候就安裝了，不需要額外裝)</em></p>
<pre tabindex="0"><code>root@localhost:~# source openrc
root@localhost:~# keystone tenant-list
... (省略) ...
</code></pre><p>接下來要設定 deployment</p>
<h3 id="step-1">Step 1</h3>
<p>首先，複製 samples 裡面的 existing.json，並修改參數</p>
<pre tabindex="0"><code>root@rally:~# cp rally/samples/deployments/existing.json ./
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;ExistingCloud&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;auth_url&#34;</span>: <span style="color:#e6db74">&#34;http://myopenstack:5000/v2.0/&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;region_name&#34;</span>: <span style="color:#e6db74">&#34;RegionOne&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;endpoint_type&#34;</span>: <span style="color:#e6db74">&#34;public&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;admin&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;username&#34;</span>: <span style="color:#e6db74">&#34;admin&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;password&#34;</span>: <span style="color:#e6db74">&#34;myStackAdmin&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;tenant_name&#34;</span>: <span style="color:#e6db74">&#34;benchmark&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>type 的部分不能換改</li>
<li><strong>auth_url</strong> 這個參數只要使用 public url 的就可以了</li>
<li>User 一定要是具有 admin role 的 user；tenant 則不一定要特地建立專門使用的，因為測試的過程不會使用到自己的 tenant。</li>
</ul>
<p>接著執行命令 <code>rally deployment create --filename=&lt;json file&gt; --name=&lt;name of Openstack deployment&gt;</code></p>
<pre tabindex="0"><code>root@rally:~# rally deployment create --filename existing.json --name myStack
+--------------------------------------+----------------------------+---------+------------------+--------+
| uuid                                 | created_at                 | name    | status           | active |
+--------------------------------------+----------------------------+---------+------------------+--------+
| 3070593f-c583-4bcf-85a8-7dc7345ad146 | 2015-02-24 03:45:37.088393 | myStack | deploy-&gt;finished |        |
+--------------------------------------+----------------------------+---------+------------------+--------+
Using deployment: 3070593f-c583-4bcf-85a8-7dc7345ad146
~/.rally/openrc was updated

HINTS:
* To get your cloud resources, run:
	rally show [flavors|images|keypairs|networks|secgroups]

* To use standard OpenStack clients, set up your env by running:
	source ~/.rally/openrc
  OpenStack clients are now configured, e.g run:
	glance image-list
root@rally:~#
</code></pre><p>這時候執行 rally show [option] 可以看到 Openstack 資訊</p>
<pre tabindex="0"><code>root@rally:~# rally show images
+--------------------------------------+------------------------------+------------+
| UUID                                 | Name                         | Size (B)   |
+--------------------------------------+------------------------------+------------+
| 53c59f00-509a-4056-b5b2-ff1984c9323f | Ubuntu 14.04 (Cloud Image)   | 256836096  |
| 75426fa5-f73b-46a4-84fa-4a44f9cbc9fb | Ubuntu 12.04 (Cloud Image)   | 261423616  |
| 7bd19a5c-0eba-439c-a627-599df9d9ad4d | CentOS 7                     | 418688512  |
+--------------------------------------+------------------------------+------------+
root@rally:~#
</code></pre><h3 id="step-2">Step 2</h3>
<p>接下來，執行 <code>rally deployment check</code></p>
<pre tabindex="0"><code>root@rally:~# rally deployment check
keystone endpoints are valid and following services are available:
+----------+----------+-----------+
| services | type     | status    |
+----------+----------+-----------+
| cinder   | volume   | Available |
| ec2      | ec2      | Available |
| glance   | image    | Available |
| keystone | identity | Available |
| nova     | compute  | Available |
| quantum  | network  | Available |
+----------+----------+-----------+
root@rally:~#
</code></pre><h2 id="benchmarking-openstack">Benchmarking OpenStack</h2>
<p>接下來跑一個 benchmark 的範例</p>
<h3 id="step-1-1">Step 1</h3>
<p>從 sample 中複製 benchmark task 範例</p>
<pre tabindex="0"><code>cp samples/tasks/scenarios/nova/boot-and-delete.json ./task-1.json
</code></pre><p>修改 task 內容</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;NovaServers.boot_and_delete_server&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;args&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;flavor&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;m1.tiny&#34;</span>
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;image&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;CirrOS 0.3.3&#34;</span>
</span></span><span style="display:flex;"><span>                },
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;force_delete&#34;</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;runner&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;constant&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;times&#34;</span>: <span style="color:#ae81ff">10</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;concurrency&#34;</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;context&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;users&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;tenants&#34;</span>: <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;users_per_tenant&#34;</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Flavor name、image name 可以用 rally show [option] 去抓取。
另外，根據 OpenStack Wiki 的<a href="https://wiki.openstack.org/wiki/Rally/Concepts">資料</a>， flavor 與 image 可以改用提供 id、uuid 的方式。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#e6db74">&#34;args&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">&#34;flavor_id&#34;</span>: <span style="color:#ae81ff">42</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;image_id&#34;</span>: <span style="color:#e6db74">&#34;73257560-c59b-4275-a1ec-ab140e5b9979&#34;</span>
</span></span><span style="display:flex;"><span>}<span style="color:#960050;background-color:#1e0010">,</span>
</span></span></code></pre></div><h2 id="step-2-1">Step 2</h2>
<p>接下來，執行 <code>rally -v task start &lt;task json file&gt; --tag &lt;task name&gt;</code></p>
<p>最後會出現:</p>
<pre tabindex="0"><code>root@rally:~# rally -v task start task-1.json --tag &#34;Task 1&#34;

... (過程省略) ...

--------------------------------------------------------------------------------
Task 9148f0ee-d5d6-42a7-a44f-d8cd81b6d309: finished
--------------------------------------------------------------------------------

test scenario NovaServers.boot_and_delete_server
args position 0
args values:
{u&#39;args&#39;: {u&#39;flavor&#39;: {u&#39;name&#39;: u&#39;m1.tiny&#39;},
           u&#39;force_delete&#39;: False,
           u&#39;image&#39;: {u&#39;name&#39;: u&#39;CirrOS 0.3.3&#39;}},
 u&#39;context&#39;: {u&#39;users&#39;: {u&#39;project_domain&#39;: u&#39;default&#39;,
                         u&#39;resource_management_workers&#39;: 30,
                         u&#39;tenants&#39;: 3,
                         u&#39;user_domain&#39;: u&#39;default&#39;,
                         u&#39;users_per_tenant&#39;: 2}},
 u&#39;runner&#39;: {u&#39;concurrency&#39;: 2, u&#39;times&#39;: 10, u&#39;type&#39;: u&#39;constant&#39;}}
+--------------------+-----------+-----------+-----------+---------------+---------------+---------+-------+
| action             | min (sec) | avg (sec) | max (sec) | 90 percentile | 95 percentile | success | count |
+--------------------+-----------+-----------+-----------+---------------+---------------+---------+-------+
| nova.boot_server   | 6.708     | 13.289    | 37.405    | 34.299        | 35.852        | 100.0%  | 10    |
| nova.delete_server | 2.347     | 3.872     | 5.509     | 4.932         | 5.22          | 100.0%  | 10    |
| total              | 9.408     | 17.16     | 39.752    | 38.566        | 39.159        | 100.0%  | 10    |
+--------------------+-----------+-----------+-----------+---------------+---------------+---------+-------+
Load duration: 85.8980619907
Full duration: 97.1042778492

HINTS:
* To plot HTML graphics with this data, run:
	rally task report 9148f0ee-d5d6-42a7-a44f-d8cd81b6d309 --out output.html

* To get raw JSON output of task results, run:
	rally task results 9148f0ee-d5d6-42a7-a44f-d8cd81b6d309

Using task: 9148f0ee-d5d6-42a7-a44f-d8cd81b6d309
root@rally:~#
</code></pre><p>跑完之後就會出現如上方範例的簡易報告，如果想要詳盡的報告內容，可以按照提示執行 <code>rally task report &lt;uuid&gt; --out &lt;html file&gt;</code> 就可以產生 html 檔案。</p>
<p>Benchmark 參數說明請參考: <a href="https://wiki.openstack.org/wiki/Rally/Concepts">https://wiki.openstack.org/wiki/Rally/Concepts</a></p>
<p>另外，Rally 官方也提供了安裝在 docker 的方法，以及如果 Rally 是安裝在 OpenStack controller 時，也有幾個比較簡易的步驟可以參考: <a href="http://rally.readthedocs.org/en/latest/tutorial.html">http://rally.readthedocs.org/en/latest/tutorial.html</a></p>
<hr>
<h1 id="troubleshooting">Troubleshooting</h1>
<h2 id="schema-validation-error">Schema validation error</h2>
<p>執行命令 <code>rally deployment create --filename=&lt;json file&gt; --name=&lt;name of Openstack deployment&gt;</code> 時發生以下錯誤:</p>
<pre tabindex="0"><code>root@rally:~# rally deployment create --filename=mystack.json --name=myStack
2015-02-24 03:11:33.579 23212 ERROR rally.api [-] Deployment 59dc5f2c-a83a-42d8-bf49-777ff5e32783: Schema validation error.
Config schema validation error: {&#39;admin&#39;: {&#39;username&#39;: &#39;admin&#39;, &#39;password&#39;: &#39;myStackAdmin&#39;, &#39;tenant&#39;: &#39;benchmark&#39;}, &#39;auth_url&#39;: &#39;http://myopenstack:5000/v2.0/&#39;, &#39;type&#39;: &#39;ExistingCloud&#39;} is not valid under any of the given schemas

Failed validating &#39;anyOf&#39; in schema:
    {&#39;anyOf&#39;: [{&#39;properties&#39;: {&#39;admin&#39;: {&#39;$ref&#39;: &#39;#/definitions/user&#39;}},
                &#39;required&#39;: [&#39;type&#39;, &#39;auth_url&#39;, &#39;admin&#39;]},
               {&#39;required&#39;: [&#39;type&#39;, &#39;auth_url&#39;, &#39;users&#39;],
                &#39;users&#39;: {&#39;items&#39;: {&#39;$ref&#39;: &#39;#/definitions/user&#39;},
                          &#39;type&#39;: &#39;array&#39;}}],
     &#39;definitions&#39;: {&#39;user&#39;: {&#39;oneOf&#39;: [{&#39;properties&#39;: {&#39;tenant_name&#39;: {&#39;type&#39;: &#39;string&#39;}},
                                         &#39;required&#39;: [&#39;username&#39;,
                                                      &#39;password&#39;,
                                                      &#39;tenant_name&#39;]},
                                        {&#39;properties&#39;: {&#39;project_domain_name&#39;: {&#39;type&#39;: &#39;string&#39;},
                                                        &#39;project_name&#39;: {&#39;type&#39;: &#39;string&#39;},
                                                        &#39;user_domain_name&#39;: {&#39;type&#39;: &#39;string&#39;}},
                                         &#39;required&#39;: [&#39;username&#39;,
                                                      &#39;password&#39;,
                                                      &#39;project_name&#39;]}],
                              &#39;properties&#39;: {&#39;password&#39;: {&#39;type&#39;: &#39;string&#39;},
                                             &#39;username&#39;: {&#39;type&#39;: &#39;string&#39;}},
                              &#39;type&#39;: &#39;object&#39;}},
     &#39;properties&#39;: {&#39;auth_url&#39;: {&#39;type&#39;: &#39;string&#39;},
                    &#39;endpoint_type&#39;: {&#39;enum&#39;: [&#39;admin&#39;,
                                               &#39;internal&#39;,
                                               &#39;public&#39;],
                                      &#39;type&#39;: &#39;string&#39;},
                    &#39;region_name&#39;: {&#39;type&#39;: &#39;string&#39;},
                    &#39;type&#39;: {&#39;type&#39;: &#39;string&#39;}},
     &#39;type&#39;: &#39;object&#39;}

On instance:
    {&#39;admin&#39;: {&#39;password&#39;: &#39;myStackAdmin&#39;,
               &#39;tenant&#39;: &#39;benchmark&#39;,
               &#39;username&#39;: &#39;admin&#39;},
     &#39;auth_url&#39;: &#39;http://myopenstack:5000/v2.0/&#39;,
     &#39;type&#39;: &#39;ExistingCloud&#39;}.
root@rally:~#
</code></pre><p>這時候執行 <code>rally deployment list</code> 可以看到 deployment 的狀態是 failed</p>
<pre tabindex="0"><code>root@rally:~# rally deployment list
+--------------------------------------+----------------------------+---------+----------------+--------+
| uuid                                 | created_at                 | name    | status         | active |
+--------------------------------------+----------------------------+---------+----------------+--------+
| 59dc5f2c-a83a-42d8-bf49-777ff5e32783 | 2015-02-24 03:11:33.195680 | myStack | deploy-&gt;failed |        |
+--------------------------------------+----------------------------+---------+----------------+--------+
root@rally:~#
</code></pre><p>雖然這時候，執行 <code>rally deployment recreate --deployment &lt;uuid of deployment&gt;</code> 就會<strong>看似</strong>恢復正常。</p>
<pre tabindex="0"><code>root@rally:~# rally deployment recreate --deployment 59dc5f2c-a83a-42d8-bf49-777ff5e32783
root@rally:~# rally deployment list
+--------------------------------------+----------------------------+---------+------------------+--------+
| uuid                                 | created_at                 | name    | status           | active |
+--------------------------------------+----------------------------+---------+------------------+--------+
| 59dc5f2c-a83a-42d8-bf49-777ff5e32783 | 2015-02-24 03:11:33.195680 | myStack | deploy-&gt;finished |        |
+--------------------------------------+----------------------------+---------+------------------+--------+
root@rally:~# rally use deployment --deployment 59dc5f2c-a83a-42d8-bf49-777ff5e32783
Using deployment: 59dc5f2c-a83a-42d8-bf49-777ff5e32783
~/.rally/openrc was updated

HINTS:
* To get your cloud resources, run:
	rally show [flavors|images|keypairs|networks|secgroups]

* To use standard OpenStack clients, set up your env by running:
	source ~/.rally/openrc
  OpenStack clients are now configured, e.g run:
	glance image-list
root@rally:~#
</code></pre><p>但是要做其他動作就會發生錯誤，例如:</p>
<pre tabindex="0"><code>root@rally:~# rally deployment check
Authentication Issues: user rally doesn&#39;t have &#39;admin&#39; role.
</code></pre><p><strong>這是因為<a href="https://wiki.openstack.org/wiki/Rally/HowTo#Step_1._Deployment_initialization_.28use_existing_cloud.29">OpenStack Wiki 教學文</a>裡，deployment.json 少了一些參數。如果是直接從 source code 裡面的 sample 中複製並修改，就不會發生這個問題。</strong></p>
<hr>
<h2 id="connectionrefused-unable-to-establish-connection-openstack-api-endpoint">ConnectionRefused: Unable to establish connection OpenStack API endpoint</h2>
<pre tabindex="0"><code>root@rally:~# rally deployment check
keystone endpoints are valid and following services are available:
Command failed, please check log for more info
2015-02-24 03:48:00.930 24945 CRITICAL rally [-] ConnectionRefused: Unable to establish connection to http://quanta-42.sslab.cs.nthu.edu.tw:35357/v2.0/OS-KSADM/services
2015-02-24 03:48:00.930 24945 TRACE rally Traceback (most recent call last):
2015-02-24 03:48:00.930 24945 TRACE rally   File &#34;/usr/local/bin/rally&#34;, line 10, in &lt;module&gt;
2015-02-24 03:48:00.930 24945 TRACE rally     sys.exit(main())
2015-02-24 03:48:00.930 24945 TRACE rally   File &#34;/usr/local/lib/python2.7/dist-packages/rally/cmd/main.py&#34;, line 42, in main
2015-02-24 03:48:00.930 24945 TRACE rally     return cliutils.run(sys.argv, categories)
2015-02-24 03:48:00.930 24945 TRACE rally   File &#34;/usr/local/lib/python2.7/dist-packages/rally/cmd/cliutils.py&#34;, line 318, in run
2015-02-24 03:48:00.930 24945 TRACE rally     ret = fn(*fn_args, **fn_kwargs)
2015-02-24 03:48:00.930 24945 TRACE rally   File &#34;&lt;string&gt;&#34;, line 2, in check
2015-02-24 03:48:00.930 24945 TRACE rally   File &#34;/usr/local/lib/python2.7/dist-packages/rally/cmd/envutils.py&#34;, line 66, in default_from_global
2015-02-24 03:48:00.930 24945 TRACE rally     return f(*args, **kwargs)
2015-02-24 03:48:00.930 24945 TRACE rally   File &#34;/usr/local/lib/python2.7/dist-packages/rally/cmd/commands/deployment.py&#34;, line 248, in check
2015-02-24 03:48:00.930 24945 TRACE rally     for service in client.services.list():
2015-02-24 03:48:00.930 24945 TRACE rally   File &#34;/usr/local/lib/python2.7/dist-packages/keystoneclient/v2_0/services.py&#34;, line 32, in list
2015-02-24 03:48:00.930 24945 TRACE rally     return self._list(&#34;/OS-KSADM/services&#34;, &#34;OS-KSADM:services&#34;)
2015-02-24 03:48:00.930 24945 TRACE rally   File &#34;/usr/local/lib/python2.7/dist-packages/keystoneclient/base.py&#34;, line 113, in _list
2015-02-24 03:48:00.930 24945 TRACE rally     resp, body = self.client.get(url, **kwargs)
2015-02-24 03:48:00.930 24945 TRACE rally   File &#34;/usr/local/lib/python2.7/dist-packages/keystoneclient/adapter.py&#34;, line 164, in get
2015-02-24 03:48:00.930 24945 TRACE rally     return self.request(url, &#39;GET&#39;, **kwargs)
2015-02-24 03:48:00.930 24945 TRACE rally   File &#34;/usr/local/lib/python2.7/dist-packages/keystoneclient/adapter.py&#34;, line 200, in request
2015-02-24 03:48:00.930 24945 TRACE rally     resp = super(LegacyJsonAdapter, self).request(*args, **kwargs)
2015-02-24 03:48:00.930 24945 TRACE rally   File &#34;/usr/local/lib/python2.7/dist-packages/keystoneclient/adapter.py&#34;, line 89, in request
2015-02-24 03:48:00.930 24945 TRACE rally     return self.session.request(url, method, **kwargs)
2015-02-24 03:48:00.930 24945 TRACE rally   File &#34;/usr/local/lib/python2.7/dist-packages/keystoneclient/utils.py&#34;, line 318, in inner
2015-02-24 03:48:00.930 24945 TRACE rally     return func(*args, **kwargs)
2015-02-24 03:48:00.930 24945 TRACE rally   File &#34;/usr/local/lib/python2.7/dist-packages/keystoneclient/session.py&#34;, line 369, in request
2015-02-24 03:48:00.930 24945 TRACE rally     resp = send(**kwargs)
2015-02-24 03:48:00.930 24945 TRACE rally   File &#34;/usr/local/lib/python2.7/dist-packages/keystoneclient/session.py&#34;, line 412, in _send_request
2015-02-24 03:48:00.930 24945 TRACE rally     raise exceptions.ConnectionRefused(msg)
2015-02-24 03:48:00.930 24945 TRACE rally ConnectionRefused: Unable to establish connection to http://quanta-42:35357/v2.0/OS-KSADM/services
2015-02-24 03:48:00.930 24945 TRACE rally
root@rally:~#
</code></pre><p>我會發生這個問題是因為，我將 Rally 安裝在 OpenStack 之外，而 <code>rally deployment check</code> 會 call internal url (或是 admin url 我不是很確定)而非 public url。不過解決方法很簡單，<strong>只要將 IP 與 hostname 對應設定到 /etc/hosts 上即可。</strong></p>
		</section>

		<div class="post-tags">
			
			
			<nav class="nav tags">
				<ul class="tags">
					
					<li><a href="/tags/openstack">openstack</a></li>
					
					<li><a href="/tags/rally">rally</a></li>
					
				</ul>
			</nav>
			
			
		</div>
		</article>
</main>
<footer>
  <div style="display:flex"></div>
  <div class="footer-info">
    2024  <a
      href="https://github.com/athul/archie">Archie Theme</a> | Built with <a href="https://gohugo.io">Hugo</a>
  </div>
</footer>


<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-GC1G5TJVGY', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</div>
    </body>
</html>
