<!DOCTYPE html>
<html><head lang="en">
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>使用 Flutter Pigeon 開發 Objective-C plugin - 世界的盡頭</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="最近在為 app 整合整合其他公司的 sdk，對方只提供 java / objective-c 的方案。因此得自己做 native plugin 開發。
Google 了一番 flutter native plugin 開發，基本都提到了 Pigeon 這個套件。使用 pigeon 可以：

同時規範 android/ios native plugin 的 api (長什麼樣子、怎麼傳參數)
自動產生 dart code
自動綁定 flutter 與 native 之間的通信

網路上的文章，大多都將 pigeon 用於單獨的 plugin 開發。而我則因為一些因素，將 peigon 用於現有的 project 裡。" />
	<meta property="og:image" content=""/>
	<meta property="og:title" content="使用 Flutter Pigeon 開發 Objective-C plugin" />
<meta property="og:description" content="最近在為 app 整合整合其他公司的 sdk，對方只提供 java / objective-c 的方案。因此得自己做 native plugin 開發。
Google 了一番 flutter native plugin 開發，基本都提到了 Pigeon 這個套件。使用 pigeon 可以：

同時規範 android/ios native plugin 的 api (長什麼樣子、怎麼傳參數)
自動產生 dart code
自動綁定 flutter 與 native 之間的通信

網路上的文章，大多都將 pigeon 用於單獨的 plugin 開發。而我則因為一些因素，將 peigon 用於現有的 project 裡。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://maple52046.github.io/posts/create-objc-plugin-for-flutter-with-pigeon/" /><meta property="og:image" content="https://maple52046.github.io/site-thumbnail.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-05T10:30:07+08:00" />
<meta property="article:modified_time" content="2023-01-05T10:30:07+08:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://maple52046.github.io/site-thumbnail.png" /><meta name="twitter:title" content="使用 Flutter Pigeon 開發 Objective-C plugin"/>
<meta name="twitter:description" content="最近在為 app 整合整合其他公司的 sdk，對方只提供 java / objective-c 的方案。因此得自己做 native plugin 開發。
Google 了一番 flutter native plugin 開發，基本都提到了 Pigeon 這個套件。使用 pigeon 可以：

同時規範 android/ios native plugin 的 api (長什麼樣子、怎麼傳參數)
自動產生 dart code
自動綁定 flutter 與 native 之間的通信

網路上的文章，大多都將 pigeon 用於單獨的 plugin 開發。而我則因為一些因素，將 peigon 用於現有的 project 裡。"/>

	
        <link href="https://maple52046.github.io/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css" rel="stylesheet">
	

	
	<link rel="stylesheet" type="text/css" media="screen" href="https://maple52046.github.io/css/main.ac08a4c9714baa859217f92f051deb58df2938ec352b506df655005dcaf98cc0.css" />

	
	

	
	
	
	
</head>
<body>
        <div class="content"><header>
	<div class="main">
		<a href="https://maple52046.github.io">世界的盡頭</a>
	</div>
	<nav>
		
		
	</nav>
</header>

<main>
	<article>
		<div class="title">
			<h1 class="title">使用 Flutter Pigeon 開發 Objective-C plugin</h1>
			<div class="meta">Posted on Jan 5, 2023</div>
		</div>
		

		<section class="body">
			<p>最近在為 app 整合整合其他公司的 sdk，對方只提供 java / objective-c 的方案。因此得自己做 native plugin 開發。</p>
<p>Google 了一番 flutter native plugin 開發，基本都提到了 <a href="https://pub.dev/packages/pigeon">Pigeon</a> 這個套件。使用 pigeon 可以：</p>
<ul>
<li>同時規範 android/ios native plugin 的 api (長什麼樣子、怎麼傳參數)</li>
<li>自動產生 dart code</li>
<li>自動綁定 flutter 與 native 之間的通信</li>
</ul>
<p>網路上的文章，大多都將 pigeon 用於單獨的 plugin 開發。而我則因為一些因素，將 peigon 用於現有的 project 裡。</p>
<p>本文創建了一個 <a href="https://github.com/maple52046/ganymede">demo project</a>，native 語言指定了 swift，並使用 objective-c 開發 plugin：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>flutter create --platforms android,ios -a kotlin -i swift ganymede
</span></span></code></pre></div><hr>
<h1 id="1-install-pigeon">1. Install Pigeon</h1>
<p>執行 <code>flutter pub add pigeon -d</code> 即可。</p>
<p>或者是編輯 <code>pubspec.yaml</code>，在 <code>dev_dependencies</code> 中增加 pigeon：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">dev_dependencies</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">flutter_test</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">sdk</span>: <span style="color:#ae81ff">flutter</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">flutter_lints</span>: <span style="color:#ae81ff">^2.0.0</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">pigeon</span>: <span style="color:#ae81ff">^4.2.14</span>
</span></span></code></pre></div><p>然後執行 <code>flutter pub get</code>。</p>
<h1 id="2-定義-plugin-api自動產生程式碼">2. 定義 plugin api，自動產生程式碼</h1>
<p>創建一個 dart 檔用來定義 plugin，例如 <code>.pigeon.dart</code>：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#39;package:pigeon/pigeon.dart&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">@</span>HostApi()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ApolloApi</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">String</span> introduction();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">String</span> greeting(<span style="color:#66d9ef">String</span> who);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>然後執行：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>mkdir -p android/app/src/main/java/com/maple52046/apollo
</span></span><span style="display:flex;"><span>flutter pub run pigeon <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --input .pigeon.dart <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --dart_out lib/apollo.dart <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --objc_header_out ios/Runner/ApolloApi.h <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --objc_source_out ios/Runner/ApolloApi.m <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --java_out android/app/src/main/java/com/maple52046/apollo/ApolloApi.java <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --java_package <span style="color:#e6db74">&#34;com.maple52046.apollo&#34;</span>
</span></span></code></pre></div><h1 id="3-匯入-plugin-到-xcode-project">3. 匯入 plugin 到 xcode project</h1>
<p>執行 <code>open ios/Runner.xcworkspace</code> 打開 xcode：</p>
<ol>
<li>將 <code>ApolloApi.h</code> 與 <code>ApolloApi.m</code> 加入到 Runner 中</li>
<li>新增標頭檔 <code>ApolloPlugin.h</code> 以及程式碼檔 <code>ApolloPlugin.m</code> <em>(名稱自訂)</em></li>
</ol>
<p><img src="https://i.imgur.com/Z4pUrt9.png" alt="Imgur"></p>
<h1 id="4-實作-native-plugin">4. 實作 native plugin</h1>
<p>Pigeon 為我們自動產生了一個 protocol，名稱為 <code>ApolloApi</code>：</p>
<p><img src="https://i.imgur.com/wP40OGm.png" alt="Imgur"></p>
<p>這個 protocol 包含了兩個 method: <code>introductionWithError</code> 與 <code>greetingWho</code>，分別對應了我們先前定義的 <code>introduction</code> 與 <code>greeting</code> 函式。至於為什麼變成這個樣子，我猜應該是為了符合 objective-c 的語法吧。</p>
<p>我們需要做的事情就是：<strong>定義一個 interface (<code>ApolloPlugin</code>) 繼承 <code>ApolloApi</code> 與 <code>GeneratedPluginRegistrant</code>，然後實作 <code>introductionWithError</code> 、<code>greetingWho</code> 以及 <code>registerWithRegistrar</code> 三個函式</strong>。</p>
<ul>
<li>編輯 <code>ApolloPlugin.h</code>，增加以下的 code：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-objc" data-lang="objc"><span style="display:flex;"><span><span style="color:#75715e">#import &#34;ApolloApi.h&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#import &#34;GeneratedPluginRegistrant.h&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@interface</span> <span style="color:#a6e22e">ApolloPlugin</span> : <span style="color:#a6e22e">GeneratedPluginRegistrant</span><span style="color:#f92672">&lt;</span>ApolloApi<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@end</span>
</span></span></code></pre></div><ul>
<li>然後編輯 <code>ApolloPlugin.m</code>，增加以下的 code：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-objc" data-lang="objc"><span style="display:flex;"><span><span style="color:#75715e">#import &lt;Flutter/Flutter.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#import &#34;ApolloApi.h&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#import &#34;ApolloPlugin.h&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">ApolloPlugin</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>+ (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">registerWithRegistry:</span>(NSObject<span style="color:#f92672">&lt;</span>FlutterPluginRegistry<span style="color:#f92672">&gt;*</span>)registry {
</span></span><span style="display:flex;"><span>    ApolloPlugin<span style="color:#f92672">*</span> api <span style="color:#f92672">=</span> [[ApolloPlugin alloc] init];
</span></span><span style="display:flex;"><span>    NSObject<span style="color:#f92672">&lt;</span>FlutterPluginRegistrar<span style="color:#f92672">&gt;*</span> registrar <span style="color:#f92672">=</span> [registry registrarForPlugin:<span style="color:#e6db74">@&#34;ApolloPlugin&#34;</span>];
</span></span><span style="display:flex;"><span>    ApolloApiSetup([registrar messenger], api);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- (nullable NSString <span style="color:#f92672">*</span>)<span style="color:#a6e22e">introductionWithError:</span>(FlutterError <span style="color:#f92672">*</span>_Nullable <span style="color:#f92672">*</span>_Nonnull)error {
</span></span><span style="display:flex;"><span>    NSString <span style="color:#f92672">*</span>message <span style="color:#f92672">=</span> <span style="color:#e6db74">@&#34;Hello, This is Applo Plugin&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> message;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- (nullable NSString <span style="color:#f92672">*</span>)<span style="color:#a6e22e">greetingWho:</span>(NSString <span style="color:#f92672">*</span>)who <span style="color:#a6e22e">error:</span>(FlutterError <span style="color:#f92672">*</span>_Nullable <span style="color:#f92672">*</span>_Nonnull)error {
</span></span><span style="display:flex;"><span>    NSString <span style="color:#f92672">*</span>message <span style="color:#f92672">=</span> [NSString stringWithFormat:<span style="color:#e6db74">@&#34;Hi, %@. I am Apollo Plugin&#34;</span>, who];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> message;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@end</span>
</span></span></code></pre></div><h3 id="generatedpluginregistrant-與-registerwithregistrar">GeneratedPluginRegistrant 與 registerWithRegistrar</h3>
<p>打開 <code>AppDelegate.swift</code>，會看到以下的程式碼：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">UIKit</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">Flutter</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@UIApplicationMain</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@objc</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AppDelegate</span>: FlutterAppDelegate {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">func</span> <span style="color:#a6e22e">application</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">_</span> application: UIApplication,
</span></span><span style="display:flex;"><span>    didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?
</span></span><span style="display:flex;"><span>  ) -&gt; Bool {
</span></span><span style="display:flex;"><span>    GeneratedPluginRegistrant.register(with: <span style="color:#66d9ef">self</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">super</span>.application(application, didFinishLaunchingWithOptions: launchOptions)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>其中，<code>GeneratedPluginRegistrant.register(with: self)</code> 就是 flutter 去註冊其他 plugin 的入口函式。如果你有其他的 flutter project，可以看一下 <code>ios/Runner/GeneratedPluginRegistrant.m</code> 的內容：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-objc" data-lang="objc"><span style="display:flex;"><span><span style="color:#66d9ef">@implementation</span> <span style="color:#a6e22e">GeneratedPluginRegistrant</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>+ (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">registerWithRegistry:</span>(NSObject<span style="color:#f92672">&lt;</span>FlutterPluginRegistry<span style="color:#f92672">&gt;*</span>)registry {
</span></span><span style="display:flex;"><span>  [CameraPlugin registerWithRegistrar:[registry registrarForPlugin:<span style="color:#e6db74">@&#34;CameraPlugin&#34;</span>]];
</span></span><span style="display:flex;"><span>  [GeolocatorPlugin registerWithRegistrar:[registry registrarForPlugin:<span style="color:#e6db74">@&#34;GeolocatorPlugin&#34;</span>]];
</span></span><span style="display:flex;"><span>  [FLTPathProviderPlugin registerWithRegistrar:[registry registrarForPlugin:<span style="color:#e6db74">@&#34;FLTPathProviderPlugin&#34;</span>]];
</span></span><span style="display:flex;"><span>  [PermissionHandlerPlugin registerWithRegistrar:[registry registrarForPlugin:<span style="color:#e6db74">@&#34;PermissionHandlerPlugin&#34;</span>]];
</span></span><span style="display:flex;"><span>  [PhotoManagerPlugin registerWithRegistrar:[registry registrarForPlugin:<span style="color:#e6db74">@&#34;PhotoManagerPlugin&#34;</span>]];
</span></span><span style="display:flex;"><span>  [SqflitePlugin registerWithRegistrar:[registry registrarForPlugin:<span style="color:#e6db74">@&#34;SqflitePlugin&#34;</span>]];
</span></span><span style="display:flex;"><span>  [SystemSettingsPlugin registerWithRegistrar:[registry registrarForPlugin:<span style="color:#e6db74">@&#34;SystemSettingsPlugin&#34;</span>]];
</span></span><span style="display:flex;"><span>  [WakelockPlugin registerWithRegistrar:[registry registrarForPlugin:<span style="color:#e6db74">@&#34;WakelockPlugin&#34;</span>]];
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@end</span>
</span></span></code></pre></div><p>每一個 plugin 都會定義 <code>registerWithRegistrar</code> 方法用來註冊自己，並裏面綁定 message channel。當然我們自己開發的 plugin 也需要做一樣的事。為了簡化步驟，我讓 <code>ApolloPlugin</code> 直接繼承了 <code>GeneratedPluginRegistrant</code>，並實作了 <code>registerWithRegistry</code> :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-objc" data-lang="objc"><span style="display:flex;"><span>+ (<span style="color:#66d9ef">void</span>)<span style="color:#a6e22e">registerWithRegistry:</span>(NSObject<span style="color:#f92672">&lt;</span>FlutterPluginRegistry<span style="color:#f92672">&gt;*</span>)registry {
</span></span><span style="display:flex;"><span>    NSObject<span style="color:#f92672">&lt;</span>FlutterPluginRegistrar<span style="color:#f92672">&gt;*</span> registrar <span style="color:#f92672">=</span> [registry registrarForPlugin:<span style="color:#e6db74">@&#34;ApolloPlugin&#34;</span>];
</span></span><span style="display:flex;"><span>    ApolloPlugin<span style="color:#f92672">*</span> api <span style="color:#f92672">=</span> [[ApolloPlugin alloc] init];
</span></span><span style="display:flex;"><span>    ApolloApiSetup([registrar messenger], api);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ol>
<li>第一個步驟就是 call <code>registry</code> 的 <code>registrarForPlugin</code> 方法註冊 plugin</li>
<li>第二個步驟是要綁定 message channel。在 <code>ApolloApi.m</code> 裡，pigeon 創建了函式 <code>ApolloApiSetup</code> 幫我們簡化了 method 與 message channel 之間綁定的步驟：</li>
</ol>
<p><img src="https://i.imgur.com/RUB7J03.png" alt="Imgur"></p>
<p>我們只需要將第一步產生 registrar 的 messenger 與 plugin 實例一起帶入到 setup function 即可。</p>
<h1 id="5-註冊-plugin-到-app">5. 註冊 plugin 到 App</h1>
<p>由於 <code>GeneratedPluginRegistrant.m</code> 是 flutter 自動產生的，我們用這種方式寫的 plugin 不能直接加入到裡面。因此還需要手動 call register 函式：</p>
<ol>
<li>編輯 <code>Runner-Bridging-Header.h</code>，增加 <code>ApolloPlugin.h</code>：</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-objc" data-lang="objc"><span style="display:flex;"><span><span style="color:#75715e">#import &#34;GeneratedPluginRegistrant.h&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#import &#34;ApolloPlugin.h&#34;
</span></span></span></code></pre></div><ol start="2">
<li>然後再編輯 <code>AppDelegate.swift</code>，增加 <code>ApolloPlugin.register(with: self)</code></li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">UIKit</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">Flutter</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@UIApplicationMain</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">@objc</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AppDelegate</span>: FlutterAppDelegate {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">func</span> <span style="color:#a6e22e">application</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">_</span> application: UIApplication,
</span></span><span style="display:flex;"><span>    didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?
</span></span><span style="display:flex;"><span>  ) -&gt; Bool {
</span></span><span style="display:flex;"><span>    GeneratedPluginRegistrant.register(with: <span style="color:#66d9ef">self</span>)
</span></span><span style="display:flex;"><span>    ApolloPlugin.register(with: <span style="color:#66d9ef">self</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">super</span>.application(application, didFinishLaunchingWithOptions: launchOptions)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>以上步驟就完成了 native plugin 開發。</p>
<h1 id="6-use-plugin-in-fluttererror">6. Use plugin in FlutterError</h1>
<p>Pigeon 自動產生了 dart class，也就是 <code>lib/apollo.dart</code> 裡的 <code>ApolloApi</code>:</p>
<p><img src="https://i.imgur.com/Nkro57W.png" alt="Imgur"></p>
<p>使用起來就跟一般 class 一樣(只不過變成了異步操作)：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dart" data-lang="dart"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#39;apollo.dart&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyWidget</span> <span style="color:#66d9ef">extends</span> StatelessWidget {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">final</span> ApolloApi api;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> MyWidget({<span style="color:#66d9ef">required</span> <span style="color:#66d9ef">this</span>.api, <span style="color:#66d9ef">super</span>.key});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#960050;background-color:#1e0010">@</span>override
</span></span><span style="display:flex;"><span>  Widget build(BuildContext context) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> Column(
</span></span><span style="display:flex;"><span>      mainAxisSize: MainAxisSize.min,
</span></span><span style="display:flex;"><span>      crossAxisAlignment: CrossAxisAlignment.center,
</span></span><span style="display:flex;"><span>      children: [
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// intruction
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        FutureBuilder<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">String</span><span style="color:#f92672">&gt;</span>(
</span></span><span style="display:flex;"><span>          future: api.introduction(),
</span></span><span style="display:flex;"><span>          builder: (context, snapshot) <span style="color:#f92672">=&gt;</span> Text(snapshot.data <span style="color:#f92672">??</span> <span style="color:#e6db74">&#39;&#39;</span>),
</span></span><span style="display:flex;"><span>        ),
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> Divider(),
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// greeting
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        FutureBuilder<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">String</span><span style="color:#f92672">&gt;</span>(
</span></span><span style="display:flex;"><span>          future: api.greeting(<span style="color:#e6db74">&#39;Bill&#39;</span>),
</span></span><span style="display:flex;"><span>          builder: ((context, snapshot) <span style="color:#f92672">=&gt;</span> Text(snapshot.data <span style="color:#f92672">??</span> <span style="color:#e6db74">&#39;&#39;</span>)),
</span></span><span style="display:flex;"><span>        ),
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<h2 id="reference">Reference</h2>
<ul>
<li><a href="https://dartling.dev/how-to-create-a-custom-plugin-in-flutter-with-pigeon">How to create a custom plugin in Flutter with Pigeon</a></li>
<li><a href="https://medium.com/@cosinus84/flutter-view-controller-used-in-ios-app-using-coordinator-pattern-8896339d64ba">Flutter navigate to another view controller in iOS using Coordinator pattern</a></li>
<li><a href="https://kaochenlong.com/2010/12/11/protocol-in-objective-c/">Protocol in Objective-C</a></li>
</ul>
		</section>

		<div class="post-tags">
			
			
			<nav class="nav tags">
				<ul class="tags">
					
					<li><a href="/tags/flutter">flutter</a></li>
					
					<li><a href="/tags/objective-c">objective-c</a></li>
					
					<li><a href="/tags/pigeon">pigeon</a></li>
					
				</ul>
			</nav>
			
			
		</div>
		</article>
</main>
<footer>
  <div style="display:flex"></div>
  <div class="footer-info">
    2024  <a
      href="https://github.com/athul/archie">Archie Theme</a> | Built with <a href="https://gohugo.io">Hugo</a>
  </div>
</footer>


<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-GC1G5TJVGY', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</div>
    </body>
</html>
