<!DOCTYPE html>
<html><head lang="en">
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>解決 vsftpd: &#34;500 OOPS: priv_sock_get_cmd&#34; - 世界的盡頭</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="最近結案了，開啟之前架好的 FTP server，準備上傳文件，卻發現不能登入 FTP server。在 FileZilla 上看到 client 的錯誤訊息是:
回應:	500 OOPS: priv_sock_get_cmd
在 server 端，/var/log/syslog 裡面看到:
Dec 25 16:46:21 portal kernel: [3212645.906540] type=1326 audit(1419497181.480:11): auid=4294967295 uid=65534 gid=65534 ses=4294967295 pid=22778 comm=&#34;vsftpd&#34; sig=31 syscall=96 compat=0 ip=0x7fff19ffec9e code=0x0
" />
	<meta property="og:image" content=""/>
	<meta property="og:title" content="解決 vsftpd: &#34;500 OOPS: priv_sock_get_cmd&#34;" />
<meta property="og:description" content="最近結案了，開啟之前架好的 FTP server，準備上傳文件，卻發現不能登入 FTP server。在 FileZilla 上看到 client 的錯誤訊息是:
回應:	500 OOPS: priv_sock_get_cmd
在 server 端，/var/log/syslog 裡面看到:
Dec 25 16:46:21 portal kernel: [3212645.906540] type=1326 audit(1419497181.480:11): auid=4294967295 uid=65534 gid=65534 ses=4294967295 pid=22778 comm=&#34;vsftpd&#34; sig=31 syscall=96 compat=0 ip=0x7fff19ffec9e code=0x0
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://maple52046.github.io/posts/solve-vsftpd-500-oopspriv-sock-get-cmd/" /><meta property="og:image" content="https://maple52046.github.io/site-thumbnail.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2014-12-25T17:26:57+08:00" />
<meta property="article:modified_time" content="2014-12-25T17:26:57+08:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://maple52046.github.io/site-thumbnail.png" /><meta name="twitter:title" content="解決 vsftpd: &#34;500 OOPS: priv_sock_get_cmd&#34;"/>
<meta name="twitter:description" content="最近結案了，開啟之前架好的 FTP server，準備上傳文件，卻發現不能登入 FTP server。在 FileZilla 上看到 client 的錯誤訊息是:
回應:	500 OOPS: priv_sock_get_cmd
在 server 端，/var/log/syslog 裡面看到:
Dec 25 16:46:21 portal kernel: [3212645.906540] type=1326 audit(1419497181.480:11): auid=4294967295 uid=65534 gid=65534 ses=4294967295 pid=22778 comm=&#34;vsftpd&#34; sig=31 syscall=96 compat=0 ip=0x7fff19ffec9e code=0x0
"/>

	
        <link href="https://maple52046.github.io/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css" rel="stylesheet">
	

	
	<link rel="stylesheet" type="text/css" media="screen" href="https://maple52046.github.io/css/main.ac08a4c9714baa859217f92f051deb58df2938ec352b506df655005dcaf98cc0.css" />

	
	

	
	
	
	
</head>
<body>
        <div class="content"><header>
	<div class="main">
		<a href="https://maple52046.github.io">世界的盡頭</a>
	</div>
	<nav>
		
		
	</nav>
</header>

<main>
	<article>
		<div class="title">
			<h1 class="title">解決 vsftpd: &#34;500 OOPS: priv_sock_get_cmd&#34;</h1>
			<div class="meta">Posted on Dec 25, 2014</div>
		</div>
		

		<section class="body">
			<p>最近結案了，開啟之前架好的 FTP server，準備上傳文件，卻發現不能登入 FTP server。在 FileZilla 上看到 client 的錯誤訊息是:</p>
<pre tabindex="0"><code>回應:	500 OOPS: priv_sock_get_cmd
</code></pre><p>在 server 端，<code>/var/log/syslog</code> 裡面看到:</p>
<pre tabindex="0"><code>Dec 25 16:46:21 portal kernel: [3212645.906540] type=1326 audit(1419497181.480:11): auid=4294967295 uid=65534 gid=65534 ses=4294967295 pid=22778 comm=&#34;vsftpd&#34; sig=31 syscall=96 compat=0 ip=0x7fff19ffec9e code=0x0
</code></pre><p>原本以為是 chroot 設定錯誤，經過 google 一番後，找到了解答: <a href="http://chemdroid.net/en/ubuntu/23-vsftpd-500-oops-priv-sock-get-cmd">VSFTPD: &ldquo;500 OOPS: priv_sock_get_cmd&rdquo;</a></p>
<p>原來是 vsftpd 3.0.0 以上的版本，搭配 Ubuntu 12.04(以上) x86_64 的 Kernel 時，會自動用到 <strong>seccomp</strong> 這個 kernel module。<em>(如果我沒有翻譯錯的話)</em></p>
<p>但是 vsftpd 3.0.0 是個有很多 bug 的版本，所以&hellip;。</p>
<p>沒想到這麼剛好，三個條件我都具備了，哈哈。</p>
<pre tabindex="0"><code>portal home # vsftpd -v
vsftpd: version 3.0.2
portal home # uname -a
Linux portal 3.8.0-19-generic #29-Ubuntu SMP Wed Apr 17 18:16:28 UTC 2013 x86_64 x86_64 x86_64 GNU/Linux
portal home # lsb_release -r -c
Release:	13.04
Codename:	raring
</code></pre><h1 id="解決方法">解決方法</h1>
<p>其實就兩個步驟:</p>
<ol>
<li>新增 <code>seccomp_sandbox=NO</code> 到 <strong>/etc/vsftpd.conf</strong></li>
</ol>
<pre tabindex="0"><code>echo &#39;seccomp_sandbox=NO&#39; &gt;&gt; /etc/vsftpd.conf
</code></pre><ol start="2">
<li>重啟 vsftpd</li>
</ol>
<pre tabindex="0"><code>service vsftpd restart
</code></pre><p>收工!~</p>
		</section>

		<div class="post-tags">
			
			
			<nav class="nav tags">
				<ul class="tags">
					
					<li><a href="/tags/vsftpd">vsftpd</a></li>
					
				</ul>
			</nav>
			
			
		</div>
		</article>
</main>
<footer>
  <div style="display:flex"></div>
  <div class="footer-info">
    2024  <a
      href="https://github.com/athul/archie">Archie Theme</a> | Built with <a href="https://gohugo.io">Hugo</a>
  </div>
</footer>


<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-GC1G5TJVGY', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</div>
    </body>
</html>
