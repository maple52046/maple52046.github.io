<!DOCTYPE html>
<html><head lang="en">
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Install Ubuntu in UEFI mode with debootstrap - 世界的盡頭</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="在 UEFI 模式下使用 LiveCD 安裝 Ubuntu，安裝完成後卻總是卡在 grub。" />
	<meta property="og:image" content=""/>
	<meta property="og:title" content="Install Ubuntu in UEFI mode with debootstrap" />
<meta property="og:description" content="在 UEFI 模式下使用 LiveCD 安裝 Ubuntu，安裝完成後卻總是卡在 grub。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://maple52046.github.io/posts/install-ubuntu-in-uefi-mode-with-debootstrap/" /><meta property="og:image" content="https://maple52046.github.io/site-thumbnail.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-11-03T15:28:19+00:00" />
<meta property="article:modified_time" content="2017-11-03T15:28:19+00:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://maple52046.github.io/site-thumbnail.png" /><meta name="twitter:title" content="Install Ubuntu in UEFI mode with debootstrap"/>
<meta name="twitter:description" content="在 UEFI 模式下使用 LiveCD 安裝 Ubuntu，安裝完成後卻總是卡在 grub。"/>

	
        <link href="https://maple52046.github.io/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css" rel="stylesheet">
	

	
	<link rel="stylesheet" type="text/css" media="screen" href="https://maple52046.github.io/css/main.ac08a4c9714baa859217f92f051deb58df2938ec352b506df655005dcaf98cc0.css" />

	
	

	
	
	
	
</head>
<body>
        <div class="content"><header>
	<div class="main">
		<a href="https://maple52046.github.io">世界的盡頭</a>
	</div>
	<nav>
		
		
	</nav>
</header>

<main>
	<article>
		<div class="title">
			<h1 class="title">Install Ubuntu in UEFI mode with debootstrap</h1>
			<div class="meta">Posted on Nov 3, 2017</div>
		</div>
		

		<section class="body">
			<p>在 UEFI 模式下使用 LiveCD 安裝 Ubuntu，安裝完成後卻總是卡在 grub。</p>
<p>錯誤畫面：</p>
<p><img src="https://i.imgur.com/E9j9j2p.png" alt="Ubuntu boot failed"></p>
<p>於是決定改採用全手動安裝的方式。</p>
<h2 id="installation">Installation</h2>
<h3 id="boot-your-pcserver-from-ubuntu-live-cd">Boot your PC/server from Ubuntu live CD</h3>
<p>Boot your PC/server from Ubuntu live CD, configure network to connect to Internet.</p>
<h3 id="prepare-the-partition">Prepare the partition</h3>
<p>Create partitions on the system disk, the first one is for EFI system; the other is for system.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo parted /dev/sda
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>parted<span style="color:#f92672">)</span> mklabel gpt
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>parted<span style="color:#f92672">)</span> mkpart ESP fat32 1MiB 128MiB
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>parted<span style="color:#f92672">)</span> mkpart primary xfs 128MiB 100%
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>parted<span style="color:#f92672">)</span> set <span style="color:#ae81ff">1</span> boot on
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>parted<span style="color:#f92672">)</span> quit
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sudo partprobe /dev/sda
</span></span><span style="display:flex;"><span>sudo mkfs.vfat -F <span style="color:#ae81ff">32</span> /dev/sda1
</span></span><span style="display:flex;"><span>sudo mkfs.xfs -f /dev/sda2
</span></span></code></pre></div><p>Mount root file system:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo mount /dev/sda2 /mnt
</span></span></code></pre></div><h3 id="install-ubuntu-core-with-debootstrap">Install Ubuntu core with debootstrap</h3>
<p>First, you need to install debootstrap:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo apt install debootstrap
</span></span></code></pre></div><p>Then, you can install ubuntu to the <code>/mnt</code> with <code>debootstrap</code> command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo debootstrap --arch amd64 xenial /mnt http://tw.archive.ubuntu.com/ubuntu
</span></span></code></pre></div><p>Copy the apt repository configuration to new file system:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo cp /etc/apt/sources.list /mnt/etc/apt/sources.list
</span></span></code></pre></div><h3 id="mount-other-file-system">Mount other file system</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo mkdir -p /mnt/boot/efi
</span></span><span style="display:flex;"><span>sudo mount /dev/sda1 /mnt/boot/efi
</span></span><span style="display:flex;"><span>sudo mount --bind /dev /mnt/dev
</span></span><span style="display:flex;"><span>sudo mount -t devpts /dev/pts /mnt/dev/pts
</span></span><span style="display:flex;"><span>sudo mount -t proc proc /mnt/proc
</span></span><span style="display:flex;"><span>sudo mount -t sysfs sysfs /mnt/sys
</span></span><span style="display:flex;"><span>sudo mount -t tmpfs tmpfs /mnt/tmp
</span></span></code></pre></div><p>Then, chroot to <code>/mnt</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo chroot /mnt /bin/bash
</span></span><span style="display:flex;"><span>export HOME<span style="color:#f92672">=</span>/root
</span></span></code></pre></div><h3 id="install-linux-kernel-grub-and-other-packages">Install Linux kernel, grub and other packages</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>apt update
</span></span><span style="display:flex;"><span>apt install linux-image-generic linux-headers-generic grub-efi
</span></span></code></pre></div><h3 id="configure-grub">Configure grub</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>grub-install --target<span style="color:#f92672">=</span>x86_64-efi --efi-directory<span style="color:#f92672">=</span>/boot/efi --bootloader-id<span style="color:#f92672">=</span>ubuntu --recheck --debug
</span></span><span style="display:flex;"><span>update-grub
</span></span></code></pre></div><hr>
<p>The reboot system.</p>
<h2 id="reference">Reference</h2>
<ol>
<li><a href="https://wiki.archlinux.org/index.php/GNU_Parted#UEFI.2FGPT_examples">GNU Parted - ArchWiki</a></li>
<li><a href="https://wiki.archlinux.org/index.php/GRUB_(%E6%AD%A3%E9%AB%94%E4%B8%AD%E6%96%87)#UEFI.E7.B3.BB.E7.B5.B1.28UEFI_systems.29">GRUB - ArchWiki</a></li>
</ol>
		</section>

		<div class="post-tags">
			
			
			<nav class="nav tags">
				<ul class="tags">
					
					<li><a href="/tags/ubuntu">ubuntu</a></li>
					
					<li><a href="/tags/uefi">uefi</a></li>
					
					<li><a href="/tags/debootstrap">debootstrap</a></li>
					
				</ul>
			</nav>
			
			
		</div>
		</article>
</main>
<footer>
  <div style="display:flex"></div>
  <div class="footer-info">
    2024  <a
      href="https://github.com/athul/archie">Archie Theme</a> | Built with <a href="https://gohugo.io">Hugo</a>
  </div>
</footer>


<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-GC1G5TJVGY', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</div>
    </body>
</html>
