
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="世界的盡頭">
    <title>OpenStack Heat 使用筆記 - 世界的盡頭</title>
    <meta name="author" content="古振浩 Chen-Hao Ku">
    
    
    
        <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"古振浩 Chen-Hao Ku","sameAs":["https://github.com/maple52046","https://twitter.com/maple52046","https://www.facebook.com/maple52046","https://www.linkedin.com/in/kuchenhao/","mailto:maple52046@gmail.com"],"image":"https://www.gravatar.com/avatar/79384e4270ffd7a2d23fc41b7533db73"},"articleBody":"Heat 是 OpenStack 中，負責提供 Orchestration 服務的 component。\nHeat 用 resource 來描述 OpenStack 的狀態。例如你設定一個 network resource，在這個 resource 中，設定名稱為 default。接下來 Heat 將會在你的 project 中，檢查是否有一個名稱為 default 的 network；如果沒有，則 Heat 將會在 project 建立 network。除了 network 之外，image、volume、port、instance 等都可以是 Heat 的 resource。\nResource 之間可以建立關連性，例如你可以先建立一個 volume resource。接下來再設定一個 instance resource ，並且在 instance resource 的 block_device_mapping 的屬性中，設定與 volume resource 建立關連性。這樣 Heat 就會先檢查 volume 是否存在，然後檢查 instance 是否存在並且 volume 是否已掛載到 instance 中。\n這個想法與許多 deployment 軟體相同，例如 Puppet 是讓使用者設定 resource，然後 Puppet 根據 resource 的描述去配置 Linux；而 Saltstack 則是根據 user 設定的 state 來配置 Linux。\n在開始之前，你必須要先準備：\n\n一個 OpenStack Account。同時你必須要確定該 platform 有安裝 Heat 服務。本文是使用 SSCloud 做 demo。\n熟悉 OpenStack 的基本操作：使用 OpenStack dashboard 或是使用 OpenStack command client。\n\nTemplate先前已經提過 Heat Resource 。在 Heat 中，由眾多 resource 所組合而成的檔案/物件就是樣版(template)。你可以使用 heat 指令來查詢你的 OpenStack platform 支援哪些 template。\n執行 heat template-version-list 會得到：\n\n\n\n從上圖中可以看到 Template type 有兩種：\n\ncfn: 是 AWS CloudFormation 的縮寫。這套 template 支援 AWS 也支援 OpenStack Heat。CFN 是採用 Json 作為檔案格式。\nhot: 是 Heat Orchestration Template 的縮寫。這套 template 只能使用於 OpenStack Heat，並不支援 AWS。一般來說，HOT 是採用 YAML 作為檔案格式。\n\n在撰寫你的 template 的時候，一開始就必須要先指定 template 的版本。例如：\n12345&#123;  \"AWSTemplateFormatVersion\" : \"2010-09-09\",  \"Description\" : \"Sample Heat template that spins up multiple instances and a private network (JSON)\",  \"Resources\" : &#123; &#125;&#125;\n\n這是一個 CFN 的 template，所以是以 Json 為檔案格式。一開始先定義這個 template 是採用哪個版本，這個設定可以從 heat template-version-list 中取得；而 Description 則是 user 可以增加的自訂描述。\n最後 Resouces 則是一個 Json object，裡面則是由多個 resource 所組成。\nResource先前已經提過，resource 就是基本描述/操作 OpenStack(AWS) 的物件。與 template 一樣，我們可以透過 heat 的指令來取得所支援的 resource 列表。\n你可以執行 heat resource-type-list，將會得到以下結果：\n\n或者是你也可以從 Horizon 上面看到 resource type list：\n\n得到 resource type list 後，接下來你需要取得 resource 的設定參數。使用 heat resource-type-template &quot;TemplateName&quot; 以及 heat resource-type-show &quot;TemplateName&quot; 來取得 resource 的詳細內容。\n\n\n在 Template 中，我們可以給 Resource 設定的選項，是該 Resource 的 properties 裡面包含的參數。以下我們以 Network 為例：\n首先，先看 OS::Neutron::Net 有什麼參數可以設定：\n\ndhcp_agent_ids、name、admin_state_up、…等是 OS::Neutron::Net 這個 resource 可以設定的參數。而每個參數下面，會有這個參數的 type、description、default、required 等屬性。 \n接下來，我們建立一個 resource object:\n123456\"heat_net1\" : &#123;  \"Type\" : \"OS::Neutron::Net\",  \"Properties\" : &#123;    \"name\" : \"my_heat_net1\",  &#125;&#125;\n\nheat_net1 是這個 resource object 的名稱，只會在這個 Template 中被使用。my_heat_net1 則是實際會在 OpenStack 中建立的網路名稱。\n那如果接下來，我們要在這個 my_heat_net1 再建立一個 subnet，要怎麼做呢？\n首先，先執行 heat resource-type-show OS::Neutron::Subnet 取得參數列表。接下來根據參數列表，建立 Subnet 的 resource object:\n123456789\"heat_subnet1\" : &#123;  \"Type\" : \"OS::Neutron::Subnet\",  \"Properties\" : &#123;    \"name\" : \"my_heat_subnet1\",    \"cidr\" : \"192.168.0.0/24\",    \"dns_nameservers\" : [\"8.8.8.8\", \"8.8.8.4\"],    \"network_id\" : &#123; \"Ref\": \"heat_net1\" &#125;  &#125;&#125;\n\n\ncidr 是 OS::Neutron::Subnet required 的參數，型態是 string，value 則是該 subnet 的 CIDR。\ndns_nameservers 雖然不是 required 參數，但是一般我們在建立 subnet 的時候，都還是需要設定這個參數，這樣 instance 取得 DHCP IP 之後，才能一併設定 DNS server。透過查詢得知，dns_nameservers 的 value 必須要是 list 型態。\nnetwork_id 與 dns_nameservers 雷同，他也不是 required 參數。但是在 OpenStack Neutron 中，subnet 是必須要歸屬在某個 network 底下。先前我們已經建立了一個 net resource objetct，利用 Ref 我們可以將這兩個 resource 中建立關連性，讓 Heat 讀取到 heat_subnet1 這個 resource object 時，會自動將 heat_net1 裡面，network ID 帶入到 network_id 這個參數中。\n\n瞭解了 resource object 是如何設定之後，接下來我們將這些 resource 放到 template 中：\n12345678910111213141516171819202122&#123;  \"AWSTemplateFormatVersion\" : \"2010-09-09\",  \"Description\" : \"Sample Heat template that spins up multiple instances and a private network (JSON)\",  \"Resources\" : &#123;     \"heat_net1\" : &#123;      \"Type\" : \"OS::Neutron::Net\",      \"Properties\" : &#123;        \"name\" : \"my_heat_net1\",      &#125;    &#125;,    \"heat_subnet1\" : &#123;      \"Type\" : \"OS::Neutron::Subnet\",      \"Properties\" : &#123;        \"name\" : \"my_heat_subnet1\",        \"cidr\" : \"192.168.0.0/24\",        \"dns_nameservers\" : [\"8.8.8.8\", \"8.8.8.4\"],        \"network_id\" : &#123; \"Ref\": \"heat_net1\" &#125;      &#125;    &#125;  &#125;&#125;\n\n以上就是一個完整的 template。\nStackTemplate 只是一個設定檔，用來告訴 Heat 如何去配置你的 project。而在 Heat 中，真正擁有這些 resource 的就是 stack。將 Template 轉成 Stack 有兩種方式：\n\n透過 Horizon 設定\n透過 heat command line 設定\n\nLaunch a Stack on Horizon步驟：\n\n先準備好你的 Template\n登入你的 OpenStack Dashboard，並選擇 Orchestration 然後再切換到 Stacks 分頁。\n點選 Launch Stack，接下來會跳出設定視窗。這裡選擇 Template 的輸入方式，如果你已經準備好了 Template file，則你可以 upload 這個檔案到 dashboard 上。\n點選 Next 之後，接下來必須要設定 Stack 的名稱，以及密碼。\n點選 Launch 之後，接下來就會回到 Stack 列表，並且新的 Stack 就會出現在列表中。\n\n接下來只要稍微等一段時間，直到 Stack 的狀態為: Create Complete。就完成工作囉!!~\nLaunch a Stack with Heat command client步驟：\n\n先準備好你的 Template\n\n使用 heat stack-create 來建立一個新的 Stack\n執行 heat stack-create -f MyTemplate.json --poll 5 MyStackName\n接下來，Heat 就會開始建立 Stack。\n\n\n完成之後，會出現 Stack MyStackName CREATE_COMPLETE。\n你可以執行 heat stack-list 來察看你的 stack 列表。\nReference\nAn Introduction to OpenStack Heat\n\n","dateCreated":"2016-06-30T15:48:16+08:00","dateModified":"2019-12-13T02:17:56+08:00","datePublished":"2016-06-30T15:48:16+08:00","description":"Heat 是 OpenStack 中，負責提供 Orchestration 服務的 component。\nHeat 用 resource 來描述 OpenStack 的狀態。例如你設定一個 network resource，在這個 resource 中，設定名稱為 default。接下來 Heat 將會在你的 project 中，檢查是否有一個名稱為 default 的 network；如果沒有，則 Heat 將會在 project 建立 network。除了 network 之外，image、volume、port、instance 等都可以是 Heat 的 resource。\nResource 之間可以建立關連性，例如你可以先建立一個 volume resource。接下來再設定一個 instance resource ，並且在 instance resource 的 block_device_mapping 的屬性中，設定與 volume resource 建立關連性。這樣 Heat 就會先檢查 volume 是否存在，然後檢查 instance 是否存在並且 volume 是否已掛載到 instance 中。\n這個想法與許多 deployment 軟體相同，例如 Puppet 是讓使用者設定 resource，然後 Puppet 根據 resource 的描述去配置 Linux；而 Saltstack 則是根據 user 設定的 state 來配置 Linux。\n在開始之前，你必須要先準備：\n\n一個 OpenStack Account。同時你必須要確定該 platform 有安裝 Heat 服務。本文是使用 SSCloud 做 demo。\n熟悉 OpenStack 的基本操作：使用 OpenStack dashboard 或是使用 OpenStack command client。\n\nTemplate先前已經提過 Heat Resource 。在 Heat 中，由眾多 resource 所組合而成的檔案/物件就是樣版(template)。你可以使用 heat 指令來查詢你的 OpenStack platform 支援哪些 template。\n執行 heat template-version-list 會得到：\n","headline":"OpenStack Heat 使用筆記","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://maple52046.github.io/2016/06/30/Notes-OpenStack-Heat-Usage/"},"publisher":{"@type":"Organization","name":"古振浩 Chen-Hao Ku","sameAs":["https://github.com/maple52046","https://twitter.com/maple52046","https://www.facebook.com/maple52046","https://www.linkedin.com/in/kuchenhao/","mailto:maple52046@gmail.com"],"image":"https://www.gravatar.com/avatar/79384e4270ffd7a2d23fc41b7533db73","logo":{"@type":"ImageObject","url":"https://www.gravatar.com/avatar/79384e4270ffd7a2d23fc41b7533db73"}},"url":"https://maple52046.github.io/2016/06/30/Notes-OpenStack-Heat-Usage/","keywords":"OpenStack, Heat"}</script>
    <meta name="description" content="Heat 是 OpenStack 中，負責提供 Orchestration 服務的 component。 Heat 用 resource 來描述 OpenStack 的狀態。例如你設定一個 network resource，在這個 resource 中，設定名稱為 default。接下來 Heat 將會在你的 project 中，檢查是否有一個名稱為 default 的 network；如果沒有，">
<meta property="og:type" content="blog">
<meta property="og:title" content="OpenStack Heat 使用筆記">
<meta property="og:url" content="https:&#x2F;&#x2F;maple52046.github.io&#x2F;2016&#x2F;06&#x2F;30&#x2F;Notes-OpenStack-Heat-Usage&#x2F;index.html">
<meta property="og:site_name" content="世界的盡頭">
<meta property="og:description" content="Heat 是 OpenStack 中，負責提供 Orchestration 服務的 component。 Heat 用 resource 來描述 OpenStack 的狀態。例如你設定一個 network resource，在這個 resource 中，設定名稱為 default。接下來 Heat 將會在你的 project 中，檢查是否有一個名稱為 default 的 network；如果沒有，">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http:&#x2F;&#x2F;i.imgur.com&#x2F;OM80xOF.png">
<meta property="og:image" content="http:&#x2F;&#x2F;i.imgur.com&#x2F;xKObLA4.png">
<meta property="og:image" content="http:&#x2F;&#x2F;i.imgur.com&#x2F;4aEEzh8.png">
<meta property="og:image" content="http:&#x2F;&#x2F;i.imgur.com&#x2F;hlFCCT8.png">
<meta property="og:image" content="http:&#x2F;&#x2F;i.imgur.com&#x2F;dn8xbUR.png">
<meta property="og:image" content="http:&#x2F;&#x2F;i.imgur.com&#x2F;xmUOcFJ.png">
<meta property="og:image" content="http:&#x2F;&#x2F;i.imgur.com&#x2F;5SgFMYz.png">
<meta property="og:image" content="http:&#x2F;&#x2F;i.imgur.com&#x2F;mBQ2eNi.png">
<meta property="og:image" content="http:&#x2F;&#x2F;imgur.com&#x2F;2vcv4Oq.png">
<meta property="og:image" content="http:&#x2F;&#x2F;i.imgur.com&#x2F;1HOe2Qu.png">
<meta property="og:image" content="http:&#x2F;&#x2F;i.imgur.com&#x2F;a9qbRcv.png">
<meta property="og:image" content="http:&#x2F;&#x2F;i.imgur.com&#x2F;r3RRcPl.png">
<meta property="article:published_time" content="2016-06-30T07:48:16.000Z">
<meta property="article:modified_time" content="2019-12-12T18:17:56.461Z">
<meta property="article:author" content="古振浩 Chen-Hao Ku">
<meta property="article:tag" content="OpenStack">
<meta property="article:tag" content="Heat">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http:&#x2F;&#x2F;i.imgur.com&#x2F;OM80xOF.png">
<meta name="twitter:creator" content="@titan1782">
    
    
        
    
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-7yv7uj2hjiyfxjpniqemlgo6xmfv4x3o4kblstx6a7uhun0eclzenhgguigr.min.css">

    <!--STYLES END-->
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-79529428-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-79529428-1');
    </script>


    

    
        
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    

<header id="header" data-behavior="5">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/%20"
            aria-label=""
        >
            世界的盡頭
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
        </a>
    
</header>

            <!-- Define author's picture -->


<nav id="sidebar" data-behavior="5">
    <div class="sidebar-container">
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/index.html"
                            
                            title="Home"
                        >
                    
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/categories"
                            
                            title="Categories"
                        >
                    
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/tags"
                            
                            title="Tags"
                        >
                    
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/archives"
                            
                            title="Archives"
                        >
                    
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="#about"
                            
                            title="About"
                        >
                    
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://github.com/maple52046" target="_blank" rel="noopener" title="GitHub">
                    
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://twitter.com/maple52046" target="_blank" rel="noopener" title="Twitter">
                    
                        <i class="sidebar-button-icon fab fa-twitter" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Twitter</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://www.facebook.com/maple52046" target="_blank" rel="noopener" title="Facebook">
                    
                        <i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://www.linkedin.com/in/kuchenhao/" target="_blank" rel="noopener" title="LinkedIn">
                    
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="mailto:maple52046@gmail.com" target="_blank" rel="noopener" title="Mail">
                    
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/atom.xml"
                            
                            title="RSS"
                        >
                    
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="5"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            OpenStack Heat 使用筆記
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2016-06-30T15:48:16+08:00">
	
		    Jun 30, 2016
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/OpenStack/">OpenStack</a>


    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <p>Heat 是 OpenStack 中，負責提供 Orchestration 服務的 component。</p>
<p>Heat 用 <strong>resource</strong> 來描述 OpenStack 的狀態。例如你設定一個 network resource，在這個 resource 中，設定名稱為 <code>default</code>。接下來 Heat 將會在你的 project 中，檢查是否有一個名稱為 <code>default</code> 的 network；如果沒有，則 Heat 將會在 project 建立 network。除了 network 之外，image、volume、port、instance 等都可以是 Heat 的 resource。</p>
<p>Resource 之間可以建立關連性，例如你可以先建立一個 volume resource。接下來再設定一個 instance resource ，並且在 instance resource 的 <code>block_device_mapping</code> 的屬性中，設定與 volume resource 建立關連性。這樣 Heat 就會先檢查 volume 是否存在，然後檢查 instance 是否存在並且 volume 是否已掛載到 instance 中。</p>
<p>這個想法與許多 deployment 軟體相同，例如 Puppet 是讓使用者設定 <strong>resource</strong>，然後 Puppet 根據 resource 的描述去配置 Linux；而 Saltstack 則是根據 user 設定的 <strong>state</strong> 來配置 Linux。</p>
<p>在開始之前，你必須要先準備：</p>
<ol>
<li>一個 OpenStack Account。同時你必須要確定該 platform 有安裝 Heat 服務。本文是使用 <a href="https://www.unicloud.org.tw/services/sscloud" target="_blank" rel="noopener">SSCloud</a> 做 demo。</li>
<li>熟悉 OpenStack 的基本操作：使用 OpenStack dashboard 或是使用 OpenStack command client。</li>
</ol>
<h1 id="Template"><a href="#Template" class="headerlink" title="Template"></a>Template</h1><p>先前已經提過 Heat Resource 。在 Heat 中，由眾多 resource 所組合而成的檔案/物件就是樣版(template)。<br>你可以使用 <code>heat</code> 指令來查詢你的 OpenStack platform 支援哪些 template。</p>
<p>執行 <code>heat template-version-list</code> 會得到：</p>
<p><img src="http://i.imgur.com/OM80xOF.png" alt="Imgur"></p>
<a id="more"></a>

<p>從上圖中可以看到 Template type 有兩種：</p>
<ol>
<li>cfn: 是 AWS CloudFormation 的縮寫。這套 template 支援 AWS 也支援 OpenStack Heat。CFN 是採用 Json 作為檔案格式。</li>
<li>hot: 是 Heat Orchestration Template 的縮寫。這套 template 只能使用於 OpenStack Heat，並不支援 AWS。一般來說，HOT 是採用 YAML 作為檔案格式。</li>
</ol>
<p>在撰寫你的 template 的時候，一開始就必須要先指定 template 的版本。<br>例如：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"AWSTemplateFormatVersion"</span> : <span class="string">"2010-09-09"</span>,</span><br><span class="line">  <span class="attr">"Description"</span> : <span class="string">"Sample Heat template that spins up multiple instances and a private network (JSON)"</span>,</span><br><span class="line">  <span class="attr">"Resources"</span> : &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>這是一個 CFN 的 template，所以是以 Json 為檔案格式。一開始先定義這個 template 是採用哪個版本，這個設定可以從 <code>heat template-version-list</code> 中取得；而 <code>Description</code> 則是 user 可以增加的自訂描述。</p>
<p>最後 Resouces 則是一個 Json object，裡面則是由多個 resource 所組成。</p>
<h1 id="Resource"><a href="#Resource" class="headerlink" title="Resource"></a>Resource</h1><p>先前已經提過，resource 就是基本描述/操作 OpenStack(AWS) 的物件。與 template 一樣，我們可以透過 heat 的指令來取得所支援的 resource 列表。</p>
<p>你可以執行 <code>heat resource-type-list</code>，將會得到以下結果：</p>
<p><img src="http://i.imgur.com/xKObLA4.png" alt="List of Heat resource type"></p>
<p>或者是你也可以從 Horizon 上面看到 resource type list：</p>
<p><img src="http://i.imgur.com/4aEEzh8.png" alt="List of Heat resource type on Horizon"></p>
<p>得到 resource type list 後，接下來你需要取得 resource 的設定參數。<br>使用 <code>heat resource-type-template &quot;TemplateName&quot;</code> 以及 <code>heat resource-type-show &quot;TemplateName&quot;</code> 來取得 resource 的詳細內容。</p>
<p><img src="http://i.imgur.com/hlFCCT8.png" alt="Heat resource-type-template"></p>
<p><img src="http://i.imgur.com/dn8xbUR.png" alt="Heat resource-type-show"></p>
<p>在 Template 中，我們可以給 Resource 設定的選項，是該 Resource 的 properties 裡面包含的參數。<br>以下我們以 Network 為例：</p>
<p>首先，先看 <code>OS::Neutron::Net</code> 有什麼參數可以設定：</p>
<p><img src="http://i.imgur.com/xmUOcFJ.png" alt="The result of show Net resource"></p>
<p><code>dhcp_agent_ids</code>、<code>name</code>、<code>admin_state_up</code>、…等是 <code>OS::Neutron::Net</code> 這個 resource 可以設定的參數。而每個參數下面，會有這個參數的 type、description、default、required 等屬性。 </p>
<p>接下來，我們建立一個 resource object:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">"heat_net1" : &#123;</span><br><span class="line">  "Type" : "OS::Neutron::Net",</span><br><span class="line">  "Properties" : &#123;</span><br><span class="line">    "name" : "my_heat_net1",</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>heat_net1</code> 是這個 resource object 的名稱，只會在這個 Template 中被使用。<code>my_heat_net1</code> 則是實際會在 OpenStack 中建立的網路名稱。</p>
<p>那如果接下來，我們要在這個 <code>my_heat_net1</code> 再建立一個 subnet，要怎麼做呢？</p>
<p>首先，先執行 <code>heat resource-type-show OS::Neutron::Subnet</code> 取得參數列表。接下來根據參數列表，建立 Subnet 的 resource object:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">"heat_subnet1" : &#123;</span><br><span class="line">  "Type" : "OS::Neutron::Subnet",</span><br><span class="line">  "Properties" : &#123;</span><br><span class="line">    "name" : "my_heat_subnet1",</span><br><span class="line">    "cidr" : "192.168.0.0/24",</span><br><span class="line">    "dns_nameservers" : ["8.8.8.8", "8.8.8.4"],</span><br><span class="line">    "network_id" : &#123; "Ref": "heat_net1" &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>cidr</code> 是 <code>OS::Neutron::Subnet</code> required 的參數，型態是 string，value 則是該 subnet 的 CIDR。</li>
<li><code>dns_nameservers</code> 雖然不是 required 參數，但是一般我們在建立 subnet 的時候，都還是需要設定這個參數，這樣 instance 取得 DHCP IP 之後，才能一併設定 DNS server。透過查詢得知，<code>dns_nameservers</code> 的 value 必須要是 list 型態。</li>
<li><code>network_id</code> 與 <code>dns_nameservers</code> 雷同，他也不是 required 參數。但是在 OpenStack Neutron 中，subnet 是必須要歸屬在某個 network 底下。先前我們已經建立了一個 net resource objetct，利用 <code>Ref</code> 我們可以將這兩個 resource 中建立關連性，讓 Heat 讀取到 <code>heat_subnet1</code> 這個 resource object 時，會自動將 <code>heat_net1</code> 裡面，network ID 帶入到 <code>network_id</code> 這個參數中。</li>
</ul>
<p>瞭解了 resource object 是如何設定之後，接下來我們將這些 resource 放到 template 中：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"AWSTemplateFormatVersion"</span> : <span class="string">"2010-09-09"</span>,</span><br><span class="line">  <span class="attr">"Description"</span> : <span class="string">"Sample Heat template that spins up multiple instances and a private network (JSON)"</span>,</span><br><span class="line">  <span class="attr">"Resources"</span> : &#123; </span><br><span class="line">    <span class="attr">"heat_net1"</span> : &#123;</span><br><span class="line">      <span class="attr">"Type"</span> : <span class="string">"OS::Neutron::Net"</span>,</span><br><span class="line">      <span class="attr">"Properties"</span> : &#123;</span><br><span class="line">        <span class="attr">"name"</span> : <span class="string">"my_heat_net1"</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="attr">"heat_subnet1"</span> : &#123;</span><br><span class="line">      <span class="attr">"Type"</span> : <span class="string">"OS::Neutron::Subnet"</span>,</span><br><span class="line">      <span class="attr">"Properties"</span> : &#123;</span><br><span class="line">        <span class="attr">"name"</span> : <span class="string">"my_heat_subnet1"</span>,</span><br><span class="line">        <span class="attr">"cidr"</span> : <span class="string">"192.168.0.0/24"</span>,</span><br><span class="line">        <span class="attr">"dns_nameservers"</span> : [<span class="string">"8.8.8.8"</span>, <span class="string">"8.8.8.4"</span>],</span><br><span class="line">        <span class="attr">"network_id"</span> : &#123; <span class="attr">"Ref"</span>: <span class="string">"heat_net1"</span> &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上就是一個完整的 template。</p>
<h1 id="Stack"><a href="#Stack" class="headerlink" title="Stack"></a>Stack</h1><p>Template 只是一個設定檔，用來告訴 Heat 如何去配置你的 project。而在 Heat 中，真正擁有這些 resource 的就是 stack。<br>將 Template 轉成 Stack 有兩種方式：</p>
<ol>
<li>透過 Horizon 設定</li>
<li>透過 heat command line 設定</li>
</ol>
<h2 id="Launch-a-Stack-on-Horizon"><a href="#Launch-a-Stack-on-Horizon" class="headerlink" title="Launch a Stack on Horizon"></a>Launch a Stack on Horizon</h2><p>步驟：</p>
<ol start="0">
<li>先準備好你的 Template</li>
<li>登入你的 OpenStack Dashboard，並選擇 <code>Orchestration</code> 然後再切換到 <code>Stacks</code> 分頁。</li>
<li>點選 <code>Launch Stack</code>，接下來會跳出設定視窗。<br><img src="http://i.imgur.com/5SgFMYz.png" alt="Launch Stack in Horizon (1)"><br>這裡選擇 Template 的輸入方式，如果你已經準備好了 Template file，則你可以 upload 這個檔案到 dashboard 上。</li>
<li>點選 <code>Next</code> 之後，接下來必須要設定 Stack 的名稱，以及密碼。<br><img src="http://i.imgur.com/mBQ2eNi.png" alt="Launch Stack in Horizon (2)"></li>
<li>點選 <code>Launch</code> 之後，接下來就會回到 Stack 列表，並且新的 Stack 就會出現在列表中。<br><img src="http://imgur.com/2vcv4Oq.png" alt="Heat Stack List"></li>
</ol>
<p>接下來只要稍微等一段時間，直到 Stack 的狀態為: <code>Create Complete</code>。就完成工作囉!!~</p>
<h2 id="Launch-a-Stack-with-Heat-command-client"><a href="#Launch-a-Stack-with-Heat-command-client" class="headerlink" title="Launch a Stack with Heat command client"></a>Launch a Stack with Heat command client</h2><p>步驟：</p>
<ol>
<li><p>先準備好你的 Template</p>
</li>
<li><p>使用 <code>heat stack-create</code> 來建立一個新的 Stack<br><img src="http://i.imgur.com/1HOe2Qu.png" alt="Help message of Heat command to create stack"></p>
<p>執行 <code>heat stack-create -f MyTemplate.json --poll 5 MyStackName</code><br><img src="http://i.imgur.com/a9qbRcv.png" alt="Launch Stack with Heat Command (1)"></p>
<p>接下來，Heat 就會開始建立 Stack。</p>
</li>
</ol>
<p>完成之後，會出現 <strong>Stack</strong> <code>MyStackName</code> <strong>CREATE_COMPLETE</strong>。<br><img src="http://i.imgur.com/r3RRcPl.png" alt="Launch Stack with Heat Command (2)"></p>
<p>你可以執行 <code>heat stack-list</code> 來察看你的 stack 列表。</p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ol>
<li><a href="http://blog.scottlowe.org/2014/05/01/an-introduction-to-openstack-heat/" target="_blank" rel="noopener">An Introduction to OpenStack Heat</a></li>
</ol>

            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/Heat/" rel="tag">Heat</a> <a class="tag tag--primary tag--small t-link" href="/tags/OpenStack/" rel="tag">OpenStack</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2017/08/02/Build-OpenCV-3-2-with-CUDA-8-0-and-Matlab/"
                    data-tooltip="Build OpenCV 3.2 with CUDA 8.0 and Matlab on Ubuntu 16.04/14.04"
                    aria-label="PREVIOUS: Build OpenCV 3.2 with CUDA 8.0 and Matlab on Ubuntu 16.04/14.04"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2016/06/29/Change-Comment-Color-in-VIM/"
                    data-tooltip="調整 vim 註解顏色"
                    aria-label="NEXT: 調整 vim 註解顏色"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://maple52046.github.io/2016/06/30/Notes-OpenStack-Heat-Usage/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://maple52046.github.io/2016/06/30/Notes-OpenStack-Heat-Usage/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="http://service.weibo.com/share/share.php?&amp;title=https://maple52046.github.io/2016/06/30/Notes-OpenStack-Heat-Usage/"
                    title="Share on Weibo"
                    aria-label="Share on Weibo"
                >
                    <i class="fab fa-weibo" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=https://maple52046.github.io/2016/06/30/Notes-OpenStack-Heat-Usage/&amp;title=OpenStack Heat 使用筆記"
                    title="Share on QQ"
                    aria-label="Share on QQ"
                >
                    <i class="fab fa-qq" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#disqus_thread"
                        aria-label="Leave a comment"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
                <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript>
</div>
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2020 古振浩 Chen-Hao Ku. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2017/08/02/Build-OpenCV-3-2-with-CUDA-8-0-and-Matlab/"
                    data-tooltip="Build OpenCV 3.2 with CUDA 8.0 and Matlab on Ubuntu 16.04/14.04"
                    aria-label="PREVIOUS: Build OpenCV 3.2 with CUDA 8.0 and Matlab on Ubuntu 16.04/14.04"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2016/06/29/Change-Comment-Color-in-VIM/"
                    data-tooltip="調整 vim 註解顏色"
                    aria-label="NEXT: 調整 vim 註解顏色"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://maple52046.github.io/2016/06/30/Notes-OpenStack-Heat-Usage/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://maple52046.github.io/2016/06/30/Notes-OpenStack-Heat-Usage/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="http://service.weibo.com/share/share.php?&amp;title=https://maple52046.github.io/2016/06/30/Notes-OpenStack-Heat-Usage/"
                    title="Share on Weibo"
                    aria-label="Share on Weibo"
                >
                    <i class="fab fa-weibo" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=https://maple52046.github.io/2016/06/30/Notes-OpenStack-Heat-Usage/&amp;title=OpenStack Heat 使用筆記"
                    title="Share on QQ"
                    aria-label="Share on QQ"
                >
                    <i class="fab fa-qq" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a
                        class="post-action-btn btn btn--default"
                        href="#disqus_thread"
                        aria-label="Leave a comment"
                    >
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="5">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://maple52046.github.io/2016/06/30/Notes-OpenStack-Heat-Usage/"
                        aria-label="Share on Facebook"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Share on Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=https://maple52046.github.io/2016/06/30/Notes-OpenStack-Heat-Usage/"
                        aria-label="Share on Twitter"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="http://service.weibo.com/share/share.php?&amp;title=https://maple52046.github.io/2016/06/30/Notes-OpenStack-Heat-Usage/"
                        aria-label="Share on Weibo"
                    >
                        <i class="fab fa-weibo" aria-hidden="true"></i><span>Share on Weibo</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="http://connect.qq.com/widget/shareqq/index.html?url=https://maple52046.github.io/2016/06/30/Notes-OpenStack-Heat-Usage/&amp;title=OpenStack Heat 使用筆記"
                        aria-label="Share on QQ"
                    >
                        <i class="fab fa-qq" aria-hidden="true"></i><span>Share on QQ</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <h4 id="about-card-name">古振浩 Chen-Hao Ku</h4>
        
            <div id="about-card-bio"><p>Taiwanese working in ShangHai</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Backend Develop Engineer, UCloud</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                ShangHai, China
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('https://i.imgur.com/XRcZuZk.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-yiemftmhqtwsxw4kjhvylvl77bvrkmkesswxwy8fiscgeiqtailhn40nft4k.min.js"></script>

<!--SCRIPTS END-->


    
        <script>
          var disqus_config = function() {
            this.page.url = 'https://maple52046.github.io/2016/06/30/Notes-OpenStack-Heat-Usage/';
              
            this.page.identifier = '2016/06/30/Notes-OpenStack-Heat-Usage/';
              
          };
          (function() {
            var d = document, s = d.createElement('script');
            var disqus_shortname = 'maple52046-githubio';
            s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
          })();
        </script>
    




    </body>
</html>
